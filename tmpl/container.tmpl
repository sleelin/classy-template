<?js
var self = this;
var isGlobalPage;

docs.forEach((doc) => {
    // we only need to check this once
    if (typeof isGlobalPage === "undefined") isGlobalPage = (doc.kind === "globalobj"); 
?>
<?js if (doc.kind === "mainpage" || (doc.kind === "package")) { ?>
    <?js= this.partial("masters/mainpage.tmpl", doc) ?>
<?js } else if (doc.kind === "source") { ?>
    <?js= this.partial("masters/source.tmpl", doc) ?>
<?js } else { ?>
    <section>
        <header>
            <?js if (!doc.longname || doc.kind !== "module") { ?>
                <h2>
                    <?js if (doc.attribs) { ?><span class="attribs"><?js= doc.attribs ?></span><?js } ?>
                    <?js if (doc.ancestors && doc.ancestors.length) { ?><span class="ancestors"><?js= doc.ancestors.join("") ?></span><?js } ?>
                    <span><?js= doc.name ?></span>
                    <?js if (doc.variation) { ?><sup class="variation"><?js= doc.variation ?></sup><?js } ?>
                    <?js if (doc.signature && !doc.hideconstructor) { ?><?js= doc.signature ?><?js } ?>
                </h2>
                <?js if (doc.classdesc) { ?><div class="class-description"><?js= doc.classdesc ?></div><?js } ?>
            <?js } else if (doc.kind === "module" && doc.modules) {
                doc.modules.forEach((module) => {
                    if (module.classdesc) { ?><div class="class-description"><?js= module.classdesc ?></div><?js } ?><?js
                })
            } ?>
            <div class="container-overview">
                <?js if (doc.kind === "module" && doc.modules) { ?>
                    <?js if (doc.description) { ?><div class="description"><?js= doc.description ?></div><?js } ?>
                    <?js doc.modules.forEach((module) => { ?><?js= this.partial("partials/method.tmpl", module) ?><?js }) ?>
                <?js } else if (doc.kind === "class" || (doc.kind === "namespace" && doc.signature)) { ?>
                    <?js= this.partial("partials/method.tmpl", doc) ?>
                <?js } else { ?>
                    <?js if (doc.description) { ?><div class="description"><?js= doc.description ?></div><?js } ?>
                    <?js= this.partial("partials/details.tmpl", doc) ?>
                    <?js= this.partial("tags/examples.tmpl", doc) ?>
                <?js } ?>
            </div>
        </header>
        <article>
            <?js if (doc.requires && doc.requires.length) { ?>
                <h3 class="subsection-title">Requires</h3>
                <ul>
                    <?js doc.requires.forEach((r) => { ?><li><?js= this.linkto(r, r) ?></li><?js }); ?>
                </ul>
            <?js } ?>

            <?js
                var classes = this.find({kind: "class", memberof: doc.longname});
                if (!isGlobalPage && classes && classes.length) {
            ?>
                <h3 class="subsection-title">Classes</h3>
                <dl>
                    <?js classes.forEach((c) => { ?>
                        <dt><?js= this.linkto(c.longname, c.name) ?></dt>
                        <dd><?js if (c.summary) { ?><?js= c.summary ?><?js } ?></dd>
                    <?js }); ?>
                </dl>
            <?js } ?>

            <?js
                var interfaces = this.find({kind: "interface", memberof: doc.longname});
                if (!isGlobalPage && interfaces && interfaces.length) {
            ?>
                <h3 class="subsection-title">Interfaces</h3>
                <dl>
                    <?js interfaces.forEach((i) => { ?>
                        <dt><?js= this.linkto(i.longname, i.name) ?></dt>
                        <dd><?js if (i.summary) { ?><?js= i.summary ?><?js } ?></dd>
                    <?js }); ?>
                </dl>
            <?js } ?>

            <?js
                var mixins = this.find({kind: "mixin", memberof: doc.longname});
                if (!isGlobalPage && mixins && mixins.length) {
            ?>
                <h3 class="subsection-title">Mixins</h3>
                <dl>
                    <?js mixins.forEach((m) => { ?>
                        <dt><?js= this.linkto(m.longname, m.name) ?></dt>
                        <dd><?js if (m.summary) { ?><?js= m.summary ?><?js } ?></dd>
                    <?js }); ?>
                </dl>
            <?js } ?>

            <?js
                var namespaces = this.find({kind: "namespace", memberof: doc.longname});
                if (!isGlobalPage && namespaces && namespaces.length) {
            ?>
                <h3 class="subsection-title">Namespaces</h3>
                <dl>
                    <?js namespaces.forEach((n) => { ?>
                        <dt><?js= this.linkto(n.longname, n.name) ?></dt>
                        <dd><?js if (n.summary) { ?><?js= n.summary ?><?js } ?></dd>
                    <?js }); ?>
                </dl>
            <?js } ?>

            <?js
                var members = this.find({kind: "member", memberof: isGlobalPage ? {isUndefined: true} : doc.longname});

                // Symbols that are assigned to module.exports are not globals, even though they're not a memberof anything
                if (isGlobalPage && members && members.length && members.forEach) {
                    members = members.filter((m) => (m.longname && m.longname.indexOf("module:") !== 0))
                }

                if (members && members.length && members.forEach) {
            ?>
                <section>
                    <h3 class="subsection-title">Members</h3>
                    <?js members.forEach((p) => { ?><?js= this.partial("partials/members.tmpl", p) ?><?js }); ?>
                </section>
            <?js } ?>

            <?js
                var methods = this.find({kind: "function", memberof: isGlobalPage ? {isUndefined: true} : doc.longname});
                if (methods && methods.length && methods.forEach) {
            ?>
                <section>
                    <h3 class="subsection-title">Methods</h3>
                    <?js methods.forEach((m) => { ?><?js= this.partial("partials/method.tmpl", m) ?><?js }); ?>
                </section>
            <?js } ?>

            <?js
                var typedefs = this.find({kind: "typedef", memberof: isGlobalPage ? {isUndefined: true} : doc.longname});
                if (typedefs && typedefs.length && typedefs.forEach) {
            ?>
                <section>
                    <h3 class="subsection-title">Type Definitions</h3>
                    <?js typedefs.forEach((e) => { ?>
                        <?js if (e.signature) { ?>
                            <?js= this.partial("partials/method.tmpl", e) ?>
                        <?js } else { ?>
                            <?js= this.partial("partials/members.tmpl", e) ?>
                        <?js } ?>
                    <?js }); ?>
                </section>
            <?js } ?>

            <?js
                var events = this.find({kind: "event", memberof: isGlobalPage ? {isUndefined: true} : doc.longname});
                if (events && events.length && events.forEach) {
            ?>
                <section>
                    <h3 class="subsection-title">Events</h3>
                    <?js events.forEach((e) => { ?><?js= self.partial("partials/method.tmpl", e) ?><?js }); ?>
                </section>
            <?js } ?>
        </article>
    </section>
    <?js } ?>
<?js }); ?>